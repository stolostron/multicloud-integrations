apiVersion: argoproj.io/v1beta1
kind: ArgoCD
metadata:
  name: openshift-gitops
  namespace: openshift-gitops
spec:
  controller:
    enabled: false
  sourceNamespaces:
    - "*"
  argoCDAgent:
    principal:
      enabled: true
      auth: mtls:CN=system:open-cluster-management:cluster:([^:]+):addon:gitops-addon:agent:gitops-addon-agent
      image: quay.io/argoprojlabs/argocd-agent:v0.6.0
      logLevel: trace
      server:
        service:
          type: LoadBalancer
      namespace:
        allowedNamespaces:
          - "*"
      tls:
        # Use controller-generated secrets
        secretName: argocd-agent-principal-tls
        rootCASecretName: argocd-agent-ca
      jwt:
        secretName: argocd-agent-jwt
